---
layout: ../layouts/Layout.astro
title: PHP EN
---

# PHP

> This php beginner friendly tutorial is from [this video](https://www.youtube.com/watch?v=BUCiSSyIGGU) and this is the [original repo](https://github.com/bradtraversy/php-crash)

## Index

- [Initialize php](#initialize-php)
- [Output](#output)
- [Variables](#variables)
- [Constants](#constants)
- [Arrays](#arrays)
- [Operators](#operators)
- [Conditionals](#conditionals)
- [Loops](#loops)
- [Functions](#functions)
- [Array functions](#array-functions)
- [String Functions](#string-functions)
- [Superglobals](#superglobals)
- [GET and POST](#get-and-post)
- [Sanitize Inputs](#sanitize-inputs)
- [Cookies](#cookies)
- [Sessions](#sessions)
- [File Handling](#file-handling)
- [File Uploading](#file-uploading)
- [Exceptions](#exceptions)
- [OOP](#oop)

## Initialize php

For using php, we need to create a .php file.
Once that, we will write the php tags:

```php
<?php
// code here
?>
```

### How PHP works

First of all, PHP runs in the server so to run it you will need a server. I recommend for beginners to start with XAMPP, that will install everything needed : [xampp website](https://www.apachefriends.org/es/index.html)

When entering a page, the browser send a request to the server, then PHP code is processed (browsers don't understand php code), after that, the server sends the right html back to the browser and then is when the user see and can interact with the page.

### Comments

- single line comments: `//inline coment`

- multiple lines comments:
  ```php
  /*
  This is a php comment
  in multiple lines
  */
  ```

> Semi-colons at end are very important!

## Output

### `echo`

You can output strings, numbres, html, etc...

```php
echo 123, 'Hello', 10.5; //123Hello10.5
```

### `print`

Like `echo` but with only one argument

```php
print 123; // 123
```

### `print_r()`

It's a function and it is most used to print arrays and single values

```php
print_r([1,2,3]);
// Array ( [0] => 1 [1] => 2 [2] => 3 )
```

### `var_dump()`

A function that returns more info (data type and length)

```php
var_dump('Hello'); // string(5) "Hello"

var_dump([1,2,3]);
// array(3) { [0]=> int(1) [1]=> int(2) 
//[2]=> int(3) }
```

### var_export()

Similar to `var_dump()` but this returns a string representation of a variable

```php
var_export('Hello'); // 'Hello'

var_export([1,2,3]);
// array ( 0 => 1, 1 => 2, 2 => 3, )
```

## Variables

### Types

- String
  : Series of chracters surrounded by quotes or doble quotes
- Integer
  : Whole number
- Float
  : Decimal number
- Boolean
  : True or False
- Array
  : Special variable, wich can hold mor than one value
- Object
  : A class
- NULL
  : Empty variable
- Resource
  : Special variable that holds a resource

### Rules

- Variables must be prefixed with $
- Variables must start with a letter or the underscore character ( \_ )
- Variables canÂ´t start with a number
- Variables can only contain alpha-numeric and underscores characters
  - A-z
  - 0-9
  - \_
- Variables are case-sensitive ($name it's not equal to $NAME)

### Declaring variables

```php
$name = 'Harold'; // String
$age = 25; //Number
$money_in_the_bank = 763.83; // Float
$has_kids = false; // Boolean
```

#### Strings with variables

To print the value of a variable in a string,you can concatenate it :

```php
echo $name . ' is ' . $age . ' years old';
// Harold is 25 years old
```

or, use double quotes :

```php
echo "$name is $age years old";
// Harold is 25 years old
```

also, like in javascript, you can add {} to the variables :

```php
echo "${name} is ${age} years old";
// Harold is 25 years old
```

### Operations

```php
echo 10 + 5; // 15
echo '10' + '5'; // 15
echo 10 - 5; // 5
echo 10 * 5 ; // 50
echo 10 / 5; // 2
echo 10 % 5; // 0
```

## Constants

A constant is some data or value that will never going to change all across your application (database credentials, host, etc...)

To create a constant you have to use the `define()` function:

```php
define('HOST','localhost');
define('PORT','3000');

echo HOST; // localhost
var_dump(PORT); // int(3000)
```

## Arrays

Arrays are data types or data structures that hold multiple values.

There are two different ways to create them :

- ```php
  $numbers = [15,22,36,41];
  ```
- ```php
  $fruits = array('apple','orange','pear');
  ```

For printing the values of the array, we can use the specific output methods mentioned in [output section](#output) :

```php
print_r($numbers);
// Array ( [0] => 15 [1] => 22 [2] => 36 [3] => 41 )

var_dump($numbers);
// array(4) { [0]=> int(15) [1]=> int(22) 
//[2]=> int(36) [3]=> int(41) }

var_export($numbers)
// array ( 0 => 15, 1 => 22, 2 => 36, 3 => 41, )
```

If we want to have access to a concrete value, we can do it by their index, but, be carefull, because **arrays index start at 0**, so the first stored value is in the 0 position:

```php
echo $fruits[0] // apple
echo $fruits[1] // orange
```

### Associative Array

The associative array is a way to create a array and customize the index.

_The keys (indexs) can be numbers or string_

1. **With Numbers:**

- ```php
    $colors = [
    1 => 'red',
    2 => 'blue',
    3 => 'green',
    5 => 'purple',
    7 => 'gray',
    11 => 'brown'
    ];
  ```
- ```php
  print_r($colors);
  // Array ( [1] => red
  //[2] => blue
  //[3] => green
  //[5] => purple
  //[7] => gray
  //[11] => brown )

  var_dump($colors);
  // array(6) { [1]=> string(3) "red" [2]=> string(4) "blue"
  // [3]=> string(5) "green" [5]=> string(6) "purple"
  // [7]=> string(4) "gray" [11]=> string(5) "brown" }

  var_export($colors);
  // array ( 1 => 'red', 2 => 'blue',
  //3 => 'green', 5 => 'purple',
  //7 => 'gray', 11 => 'brown', )

  echo $colors[1]; // red
  ```

2. **With Strings:**

- ```php
    $hex = [
    'red'=>'#f00',
    'green'=>'#0f0',
    'blue'=>'#00f',
    'black'=>'#000',
    'white'=>'#fff'
    ];
  ```
- ```php
    print_r($hex);
    // Array ( [red] => #f00
    //[green] => #0f0 [blue] => #00f
    //[black] => #000 [white] => #fff )

    var_dump($hex);
    // array(5) { ["red"]=> string(4) "#f00"
    //["green"]=> string(4) "#0f0"
    //["blue"]=> string(4) "#00f"
    //["black"]=> string(4) "#000"
    //["white"]=> string(4) "#fff" }

    var_export($hex);
    // array ( 'red' => '#f00',
    //'green' => '#0f0',
    //'blue' => '#00f',
    //'black' => '#000',
    //'white' => '#fff', )

    echo $hex['red']; // #f00
  ```

  _This ways are similar to javascript objects or python dictionaries_

### Multidimensional Array

This type of arrays are the ones who include an array inside itselfs (array inside other array).

```php
$people = [
    [
        'first_name' => 'Jhon',
        'last_name' => 'Doe',
        'email' => 'jhondoe@gmail.com'
    ],
    [
        'first_name' => 'Elena',
        'last_name' => 'Doe',
        'email' => 'elenadoe@gmail.com'
    ],
    [
        'first_name' => 'Harold',
        'last_name' => 'Cooper',
        'email' => 'harold.cooper@gmail.com'
    ]
];
```

And for returning some especific value we use the index as before:

```php
echo $people[1]['email']; // elenadoe@gmail.com
```

As this type of array is similar to json, we can return it in json format by simply usig json_encode function :

```php
print_r(json_encode($people));
/* [
    {
        "first_name":"Jhon",
        "last_name":"Doe",
        "email":"jhondoe@gmail.com"
    },
    {
        "first_name":"Elena",
        "last_name":"Doe",
        "email":"elenadoe@gmail.com"
    },
    {
        "first_name":"Harold",
        "last_name":"Cooper",
        "email":"harold.cooper@gmail.com"
    }
    ]
*/
```

## Operators

- <
  : Less than
- \>
  : Greater than
- <=
  : Less or equal to
- \>=
  : Greater or equal to
- ==
  : Equal to
- ===
  : Identical to
- !=
  : Not equal to
- !==
  : Not identical to

## Conditionals

### if

If statement syntax :

```php
if (condition) {
    // code to be executed if condition is true
}
```

Example :

```php
$age = 19;
if ($age >= 18) {
    echo 'You are old enough to vote';
}
// You are old enough to vote
```

As age is equal or greater than 18 (19) it will return the inside of the if as the condition is met.

#### Else

But, what if we want to return oher value if the conditions are not true? This can be easily managed with `else` statement:

```php
if (condition) {
    // code to be executed if condition is true
} else {
    // if the above code it's not true, 
    //this code will be executed
}
```

Example :

```php
$age = 19;
if ($age >= 18) {
    echo 'You are old enough to vote';
} else {
    echo "You still can't vote";
}
// You still can't vote
```

If all the above conditions ar not true, the else code will be executed, if any of them are true, php will never reach that else statement.

#### Elseif

Now we can say 2 conditions, if one is true, it will be executed and if not, the else will be executed. But what if we need more than 2 conditions?

This where we need the `elseif` statement :

```php
if (condition1) {
    // code to be executed if condition is true
} elseif (condition2) {
    // code to be executed if condition2 is true
} else {
    // if none of the above conditions are 
    //true, this code will be executed
}
```

Example :

```php
$time = 16;

if ($time < 12) {
    echo 'Good morning';
} elseif ($time < 17) {
    echo 'Good Afternoon';
} else {
    echo 'Good evening';
}
```

Now, with this `elseif()` statement. you can check as many conditions you may need!

However, you can also check more things apart from if something is greater, equal or less than other thing, let see two examples without using this operators:

- True or False

  ```php
     $qualified = true;

     if ($qualified) {
         echo 'Congratulations, you are qualified!';
     } else {
         echo 'You are not qualified :(';
     }
     // Congratulations, you are qualified!
  ```

- Empty or not

  ```php
  $active_users = ['Philip','Jhon','Elena'];

  if (!empty($active_users)) {
      echo "There are active users, like $active_users[0]";
  } else {
      echo 'No active users';
  }
  // There are active users, like Philip
  ```

### Ternary operators

This if statement takes a lot of space, the most simple one is at least, 3 lines long. This can be shorted by using the ternary operator :

```php
echo condition ? /*if true*/ : /*if false*/;
```

Example :

```php
$active_users = ['Philip','Jhon','Elena'];

echo !empty($active_users) ? 'There are active users' : 'No active users';
// There are active users
```

Also, we can use these ternary operator for conditional assignement.

Example:

```php
$active_users = ['Philip','Jhon','Elena'];

$first_active_user = !empty($active_users) ? $active_users[0] : 'No active users';

echo $first_active_user;
// Philip
```

But what if we actually don't want that our conditinal variable have value if the condition is not met?. What if we really don't want the `else` statement?

For this problem we have two solutions:

- ```php
    $active_users = ['Philip','Jhon','Elena'];

    $first_active_user = !empty($active_users) ? $active_users[0] : null ;
    echo $first_active_user; // Philip
  ```

- ```php
    $active_users = ['Philip','Jhon','Elena'];

    $first_active_user = $active_users[0] ?? null;
    echo $first_active_user; // Philip
  ```

Both are the same but, the last one is shorter!

### Switch

This conditional is very usefull if we have many conditions. This helps us to have more clean code instead of so many `elseif`.

```php
switch (variable) {
    case value :
    // code to execute
    break;
    case other_value :
    // code to execute
    break;
    // more case conditions
    default:
    // if none of the above are true
}
```

Example :

```php
$favcolor = 'yellow';

switch ($favcolor) {
    case 'blue':
    echo 'Your favorite color is blue';
    break;
    case 'red':
    echo 'Your favorite color is red';
    break;
    case 'green':
    echo 'Your favorite color is green';
    break;
    default:
    echo 'Your favorite color is not red, blue or green'
}
// Your favorite color is not red, blue or green
```

But let explain what happened here. Each case work as an `elseif` condition, but, if all of them are false, it will execute the `default`, that's like an `else`.

## Loops

Loops are basically used to execute a piece of code while a specific condition is met and will keep executing that code until is no longuer met.

There diferent types of loops:

### For

```php
for (initialize; condition; increment) {
    // code to execute while condition es true
}
```

Example :

```php
for ($x = 0; $x < 10; $x++) {
   echo $x;
}
// 0123456789
```

### While

```php
while (condition) {
    // code to be executed
}
```

Example :

```php
$x = 0;

while ($X < 10) {
    echo $x;
    $x++;
}
// 0123456789
```

### Do while

```php
do {
  // code to be executed
} while (condition);
```

Example :

```php
$x = 1;

do {
  echo $x;
  $x++;
} while ($x < 10);
// 0123456789
```

**Be carefull**: `do...while` always execute first and checks second:

```php
$x = 50;

do {
  echo $x;
  $x++;
} while ($x < 10);
// 50
```

### For each

Is usually used for arrays

```php
foreach ($array as $value) {
  // code to be executed
}
```

Example :

```php
$posts = ['first','second','third','fourth'];

foreach ($posts as $post) {
  echo $post . ' ';
}
// first second third fourth
```

Also, with `foreach` we can obtain the index of the values from the array :

```php
$posts = ['first','second','third','fourth'];

foreach ($posts as $index => $post) {
  echo $index . '-' . $post . ' ';
}
// 0-first 1-second 2-third 3-fourth
```

As we sais before, there are different types of arrays so... let's try this `foreach` loop with an [associative array](#associative-array)

```php
$hex = [
  'red'=>'#f00',
  'green'=>'#0f0',
  'blue'=>'#00f',
  'black'=>'#000',
  'white'=>'#fff'
];

foreach($hex as $key => $color) {
  echo "$key is $color <br/>";
}
/*red is #f00
green is #0f0
blue is #00f
black is #000
white is #fff
*/
```

## Functions

Functions are basicaly, blocks of code you can name and run anywhere.

For creating a function you use the `function` keyword and after that the name of teh function.

```php
function name () {
  // block of code that will be executed
}
```

Example :

```php
function say_hi () {
  echo 'Hello!';
}
```

What we have done there is just declare the function, right now it will not execute the code inside. For that, we need to call it:

```php
function say_hi () {
  echo 'Hello!';
}

say_hi(); // Hello!
```

### Scope

As in other languages, php function have their own scope.

What that it means? This means that if we declare any variable only inside the function, outside it it will not exist.

Example :

```php
function say_hi () {
  $hi = 'Hello!';
  echo $hi;
}

say_hi(); // Hello!
```

As we declared the variable `$hi` inside the function `say_hi`, it will have access to it's value, but, if we try to call this variable outside the function, we will get an error!:

```php
function say_hi () {
  $hi = 'Hello!';
  echo $hi;
}

say_hi(); // Hello!

echo $hi; // Warning: Undefined variable $hi
```

We get this error because `$hi` is in the function scope and we tryed to access his value as it was a variable in the global scope.

The same will happen if we try to read a global variable inside a function :

```php
  $hi = 'Hello!';
function say_hi () {
  echo $hi;
}

say_hi(); // Warning: Undefined variable $hi

echo $hi; // Hello!
```

But, how we can read a global variable inside the function? For this we can use `global` :

```php
  $hi = 'Hello!';
function say_hi () {
  global $hi;
  echo $hi;
}

say_hi(); // Warning: Undefined variable $hi

echo $hi; // Hello!
```

### Arguments

Arguments defines what's going into the function and parameters are passed to the function inside the `()` when calling it.

```php
function name ($argument) {
  // code to execute when called
}

name (parameter);
```

Example :

```php
function say_hi ($time_day) {
  echo "Hello!, good $time_day";
}

say_hi ("afternoon"); //Hello!, good afternoon
```

#### Default Values

If we declare a function with arguments, but we don't pass any parameter when called, a error will be thrown. For avoiding that, we have the default values :

```php
function say_hi ($time_day = 'morning') {
  echo "Hello!, good $time_day";
}

say_hi (); //Hello!, good morning
```

### Output

In the above examples, we are always making some 'echo' inside the function, but there is other way to get the value and it's by returnin it with the `return`:

```php
function name () {
  return // code to be returned
}

name();
```

But if we try this, nothing is displayed in the browser.

That is because we need and explicit `echo` to display the value of the return:

Example:

```php
function sum ($n1,$n2) {
  return $n1 + $n2;
}

echo sum(1,5); // 6
```

Also, we can assign the returned value of the function to a variable :

```php
function sum ($n1,$n2) {
  return $n1 + $n2;
}

$result = sum(1,5);

echo $result; // 6
```

### Anonymous Functions

We can also have functions without a name, this are called anonymous functions, and the look like this:

```php
$variable = function() {
  return // code to be returned
};
```

It works as a regular function, having arguments and all the function capabilities.

Example:

```php
$sum = function ($n1,$n2) {
  return $n1 + $n2;
};
echo $sum(1,5); // 6
```

### Arrow functions

Functions have their own shorted syntax, and looks like this :

```php
$variable = fn($argument) => argument;
```

When talking about a single line return, we can get rid of `{}` and the `return` itself, also we change the `function` keyword by the `fn`, much short and easy.

Example :

```php
$sum = fn($n1,$n2) => $n1 + $n2;

echo $sum(1,5); //
```

**Be carefull :** If the return isn't a single line one, you have to use the `{}` and also the `return` keyword

## Array functions

This type of functions are usefull for getting information on a specific array or manipulating and working with the data of it.

For the next examples we will use this arrays :

```php
$fruits = ['apple','orange','pear'];
```

### Get length

For getting the length of an array we will use the `count()` function :

```php
echo count($fruits); // 3
```

### Search array

Search inside the array for a especific value.

For that we use the `in_array()` function, that return true or false, true if any value met the requirements, and false if don't.

```php
echo in_array('orange',$fruits); // 1
```

It returns 1 because an `echo` of `true`, displays 1, while an `echo` of `false` desn't display anything.

### Add to array

If we want to add certain value to an array, there are some ways to do it:

**Add to the end :**

- ```php
  $fruits[] = 'grape';

  print_r($fruits);
  // Array ( [0] => apple [1] => orange 
  //[2] => pear [3] => grape )
  ```

- ```php
    array_push($fruits,'grape','blueberry');

    print_r($fruits);
    // Array ( [0] => apple 
    //[1] => orange 
    //[2] => pear 
    //[3] => grape 
    //[4] => blueberry )
  ```

  **Add to the beginning :**

- ```php
  array_unshift($fruits,'grape');

  print_r($fruits);
  // Array ( [0] => grape [1] => apple 
  //[2] => orange [3] => pear )
  ```

### Remove from array

**Remove from the end :**

```php
array_pop($fruits);

print_r($fruits);
// Array ( [0] => apple [1] => orange )
```

**Remove from the beginning :**

```php
array_shift($fruits);

print_r($fruits);
// Array ( [0] => orange [1] => pear )
```

**Remove specific elemen :**

```php
unset($fruits[1]);

print_r($fruits);
// Array ( [0] => apple [2] => pear )
```

### Split array

For this example, we will split the array in 2 chunks, but you can do it in as many chunks as you want and can.

```php
$chunked_array = array_chunk($fruits,2);

print_r($chunked_array);
// Array ( [0] => Array (
  //[0] => apple
//[1] => orange )
//[1] => Array (
  //[0] => pear ) )
```

### Concatenate arrays

For this example we will use this new arrays:

```php
$arr1 = [1,2,3];
$arr2 = [4,5,6];
```

For concatenating the arrays we can use the `array_merge()` function:

```php
$arr3 = array_merge($arr1,$arr2);

print_r($arr3);
// Array ( [0] => 1 [1] => 2 [2] => 3 [3] => 4 [4] => 5 [5] => 6 )
```

Also, we can use the spread operator as in JavaScript :

```php
$arr3 = [...$arr1, ...$arr2];

print_r($arr3);
// Array ( [0] => 1 [1] => 2 [2] => 3 [3] => 4 [4] => 5 [5] => 6 )
```

### Combine arrays

For this example we will use this new arrays:

```php
$a = ['red','green','blue'];
$b = ['avacado','apple','bannana'];
```

Fr combining those 2 arrays, we use the built in function called `array_combine()`:

```php
$c = array_combine($a,$b);

print_r($c);
// Array ( [red] => avacado [green] => apple [blue] => bannana )
```

_What had happen?_ The `$a` array has been taken as index and the `$b` array as values, so, the first value of the `$a` is the index of the first value of array `$b`

Now, as we have a combined array (`$c`), we can have fun with it:

**Create an array of the keys :**
_This will return the `$a` array_

```php
$keys = array_keys($c);

print_r($keys);
// Array ( [0] => red [1] => green [2] => blue )
```

**Flip the array**

```php
$flipped = array_flip($c);

print_r($flipped);
// Array ( [avacado] => red [apple] => green [bannana] => blue )
```

### Array with range of numbers

Many times we will want to have an array with numbers from 0 to 9, or from one to another number and with the built in function called `range()`, that takes a couple of arguments like start and end :

```php
$numbers = range(1,9);

print_r($numbers)
// Array ( [0] => 1
//[1] => 2
//[2] => 3
//[3] => 4
//[4] => 5
//[5] => 6
//[6] => 7
//[7] => 8
//[8] => 9 )
```

### Map an array

```php
$newNumbers = array_map(function($number){
  return "Number {$number}";
},$numbers);
```

But as we learned previously, the return itself does not display anything, so we need to print it:

```php
print_r($newNumbers);
// Array ( [0] => Number 1
//[1] => Number 2
//[2] => Number 3 [3] => Number 4
//[4] => Number 5 [5] => Number 6 [
  //6] => Number 7 [7] => Number 8
  //[8] => Number 9 )
```

### Filter an array

```php
$lessThan10 = array_filter($numbers,fn($number)=> $number < 10);

print_r($lessThan10);
// Array ( [0] => 1
//[1] => 2
//[2] => 3
//[3] => 4
//[4] => 5
//[5] => 6
//[6] => 7
//[7] => 8
//[8] => 9 )
```

### Reduce an array

What if we want to sum, multiply, divide or whatever with all the array values? For that case, we hav a built in array function called `array_reduce()`.

This function takes 2 arguments, first to array we want to reduce, and second a function that takes other 2 arguments, first one is the `$carry` that holds the return value of the previous iteration, and the second one is the name of the values.

```php
$reduce = array_reduce(
    $array,
    function ($carry, $arr) {
        return $carry + $arr;
    }
);
```

Example :

```php
$sum_numbers = array_reduce($numbers, fn($carry, $number)=> $carry + $number);

echo $sum_numbers
// 45
```

## String functions

For this string functions, we will work with the `Hello World` string.

```php
$string = 'Hello World';
```

### Length of a string

```php
echo strlen($string); // 11
```

### Find the index of a substring

- First ocurrence
  :
  ```php
  echo strpos('o'); // 4
  ```
- Last ocurrence
  :
  ```php
  echo strrpos('o'); // 7
  ```

### Reverse a string

```php
echo strrev($string); // dlroW olleH
```

### Convert characters of a string

- All to lower case
  :
  ```php
  echo strtolower($string); // hello world
  ```
- All to upper case
  :
  ```php
  echo strtoupper($string); // HELLO WORLD
  ```
- First to upper case
  :
  ```php
  echo ucwords($string); // Hello World
  ```

### Replace a substring

```php
echo str_replace('World','Everyone',$string); // Hello Everyone
```

### Portion of a string

```php
echo substr($string, 0, 5); // Hello

echo substr($string, 5); // World
```

### Start or ends with

- Starts with
  :
  ```php
  var_dump(str_starts_with($string,'Hello'));
  // bool(true)
  ```
- Ends with
  :
  ```php
  var_dump(str_ends_with($string,'ld'));
  // bool(true)
  ```

### Print formated string

If e have some string that will have a part that will be fixed and other tha will change depending on the data, we can use the `printf()` built in function, that we could use with substrinsg :

```php
printf('%s likes to %s','Jhon','code');
// Jhon likes to code
```

The `%s` is the substitution of the string. Now, an example with numbers :

```php
printf('1+1=%d',1+2);
// 1+1=3
```

In this case, the `%d` replace the number passed in the next argument.

### Handle html strings

If we `echo` any html tag, like `h1` or `hr`, it will be displayed as it was normal html as it isn't parsed.

That, in terms of security, while having a form or something like that can be extremely dangerous, as if we do the following :

```php
echo '<script>alert(1)</script>';
```

The `script` will be executed as if it was the common `script` tag.

At first look it may be not seems like a big problem, but if we have some input as i said before, and we echo the value given by the user in that input, if he puts his name, the result will be something like this :

```php
$input_value = 'Jhon';

echo $input_value;// Jhon
```

But, if he puts an `script` in the input field, it will be interpreted as common html.

```php
$input_value = '<script>alert(10)</script>';

echo $input_value;
// this will give an alert in the browser
```

Imagine that the users could run any javascript and change the functionality of your web, and even worst, change or delete important information like the stored in your database!

For this we have two ways to fix it :

- Html Special Chars
  :
  ```php
  echo htmlspecialchars($input_value);
  // <script>alert(1)</script>
  ```
- Html Entities
  :
  ```php
  echo htmlentities($input_value);
  // <script>alert(1)</script>
  ```

## Superglobals

We already have seen that in php there are some built in functions, but also there are built in variables, that are available in all scopes (inside or outside a function). They usually start with `$_` and all of them are arrays :

- `$_GET`
  : Contains information about variables passed through a URL or a form.
- `$_POST`
  : Contains information about variables passed through a form.
- `$_COOKIE`
  : Contains information about variables passed through a cookie.
- `$_SESSION`
  : Contains information about variables passed through a session.
- `$_SERVER`
  : Contains information about the server environment.
- `$_ENV`
  : Contains information about the environment variables.
- `$_FILES`
  : Contains information about files uploaded to the script.
- `$_REQUEST`
  : Contains information about variables passed through the form or URL.

## GET and POST

In the [handle html strings section](#handle-html-strings) we have talked about inputs and getting data that an user type. For doing that we will need this superglobals.

We can pass data through urls (`$_GET`) and forms (`$_GET`, `$_POST`) using this superglobals.

### GET

`$_GET` can read data from an form and from an url.

If we have some argument that we want to pass trough pages, we can add it to the anchor `href` atribute like this:

```php
<a href="/profile.php?name=Brad">Click me</a>
```

In that piece of code, we are saying that we want to go the this url:

`/profile.php?name=Brad`

If we take a look, we have a `name` atribute that is equal to `Brad`, that's the atribute we will read in the `$_GET`.
And as it is a valid url, we will go there.

Now, in the **profile.php** file, we have the `$_GET` ready, listening to the name :

```php
<?php
  echo $_GET['name'];
  // Brad
?>
```

The `$_GET` reads the `name` atribute from the url.

If we want to add more data, we can use the `&` :

```php
<a href="/profile.php?name=Brad&active=true">Click me</a>
```

And, in the **profile.php** file :

```php
<?php
  echo $_GET['name'];
  echo $_GET['active'] ? ' is active' : ' is not active';
?>
// Brad is active
```

Now, lets try this with forms.

First, we need to built our form:

```php
<form>
  <label>Name :</label>
  <input type="text" />
  <br />
  <label>Age</label>
  <input type="number" />
  <br />
  <input type="submit" />
</form>
```

This is a regular form, but as we are working with PHP, we need to add some atributes to it :

```php
<form action="/profile.php" method="GET">
  <label>Name :</label>
  <input type="text" name="name" />
  <br />
  <label>Age</label>
  <input type="number" name="age" />
  <br />
  <input type="submit" name="submit" />
</form>
```

We have added several things :

- name
  : to let `$_POST` and `$_GET` read the value when submiting.
- method
  : to specify if we want it as POST or GET when submiting (default is GET).
- action
  : this will send the data to the specified php file in this atribute ('/' send to the same file).

Now, if we click in the submit button, we will be redirected to the `profile.php` file, and we will pass to it the data :

```php
<?php
  echo $_GET['name'];
  echo '<br/>';
  echo $_GET['age'];
?>
// Brad
// 30
```

The age and name stands for the `name` atribute in each input.

But, if look at the url of this progilr.php, we will see something like this :

```
/profile.php?name=Brad&age=30&submit=Submit
```

This does not look very clean, that is why we will use the POST method and the `$_POST` to get that data with a much cleaner and friendly url.

### POST

`$_POST` is only used with forms as it hasn't access to the url parameters.

For using it, we only change the `method` atribute in the main php file :

```php
<form action="profile.php" method="POST">
    <label>Name :</label>
    <input type="text" name="name" />
    <br />
    <label>Age</label>
    <input type="number" name="age" />
    <br />
    <input type="submit" name="submit" />
</form>
```

And, we have to change the `$_GET` in the **profile.php** file for the `$_POST` ones :

```php
<?php
  echo $_POST['name'];
  echo '<br/>';
  echo $_POST['age'];
?>
// Brad
// 30
```

Now, we have the same result as before, but with a cleaner url.

### Undefined array key problem

If we tr this GET and POST methods to our own file, or we try to access directly (from the url) to the **profile.php** file, we will see this error :

```
Warning: Undefined array key "name" in /var/www/html/profile.php on line 14
```

This is thrown because at the time to make that request to the server, any `name` parameter or ulr-atribute is set, so it's undefined.

But, how can we avoid this, as at the first time that page loads, it will be none atribute set.

The way to solve this problem is with the `isset()` built in function :

```php
<?php
if(isset($_POST['submit'])){
  echo $_POST['name'];
  echo '<br/>';
  echo $_POST['age'];
}
?>
```

## Sanitize Inputs

We have talked early about some [security risks](#handle-html-strings) that inputs can have, so let's upgrade that knowledge adding a new wat to sanitize your inputs and make them more safe.

Apart from the `htmlspecilchars` or `htmlentities` we can use other built in function called `filter_input()`.

This function needs 3 atributes:

1. The type, that can be any of this :

   - INPUT_GET
   - INPUT_POST
   - INPUT_COOKIE
   - INPUT_SERVER
   - INPUT_ENV

   Each one corresponds to a [superglobal variable](#superglobals) In our case, as we have the POST method,we will use the `INPUT_POST`.

2. The variable name :

   This is the string that goes inside the `[]` in the `$_POST`.

   In this case, as we only need to sanitize the name input, this string will be `name`.

3. The filter :

   In this argument, we have to specify the ID of the filter to apply.

   In our case, we will use the `FILTER_SANITIZE_SPECIAL_CHARS`.

Once said that, the result will look like this :

```php
<?php
if (isset($_POST['submit'])) {
  $name = filter_input(INPUT_POST, 'name', FILTER_SANITIZE_SPECIAL_CHARS);
  echo $name;
  echo '<br/>';
  echo $_POST['age'];
}
?>
```

Other way to sanitize our inputs is using `filter_var()`, that works similar as `filter_input()`, but this can be used with mora things than inputs.

Example :

```php
<?php
if (isset($_POST['submit'])) {
  $name = filter_var($_POST['name'], FILTER_SANITIZE_SPECIAL_CHARS);
  echo $name;
  echo '<br/>';
  echo $_POST['age'];
}
?>
```

## Cookies

Cookies ara a mechanism for storing data in the remote browser and thus tracking or identifying return users. You can set specific data to be stored in the browser, and then retrieve it when the user visits the site again.

### Set cookie

For setting the cookie, we will need 3 parameters:

- Key
  : For referencing that cookie in the future.
- value
  : The value of that cookie.
- Expiration time
  : When we want that the cookie expire.

Example :

```php
setcookie('name','Brad',time()+86400);
// we set the cooki for one day
```

### Read cookie

For this we will use the `$_COOKIE` superglobal :

```php
if(isset($_COOKIE['name'])){
  echo $_COOKIE['name'];
}
```

### Delete a cookie

For deleting a cookie is as simple and logical as set to it an passed expiration date:

```php
setcookie('name','',time()-86400);
```

## Sessions

Sessions are a way to store information (in variables) to be used across multiple pages.

Unlike cookies, sessions are stored on the server and not in the client.

First of all, for using sessions in any php file, you need to put the "initializer" :

```php
<?php
session_start();
// code
?>
```

### Set session

```php
$username = $_POST["username"];
$_SESSION['username'] = $username;
```

### Read session

```php
$username = $_SESSION['username'];
```

### Delete session

```php
session_destroy();

// we can redirect to other page
header('Location:/index.php');
```

## File handling

File handling is the ability to read and write files on the server.

PHP has built in functions for reading and writing files.

First, we need to create a file, that we will call `users.txt`, that will have the following content :

```txt
Brad
Jhon
Sara
Steve
Harry
```

Also we will create a variable called `filep` that will contain the path to the `users.txt` :

```php
$filep = './users.txt';
```

### File exists

```php
file_exists($filep);
```

### Read file

```php
echo readfile($filep);
// Brad Jhon Sara Steve Harry26
```

Other way to read a file is with `fread()`, that need 2 arguments : stream and length :

```php
$handle = fopen($filep,'r');
// r means open for reading only
$contents = fread($handle,filesize($filep));
fclose($handle);
echo $contents;
// Brad Jhon Sara Steve Harry
```

### Writing file

```php
$handle = fopen($filep,'w');
// r means open for writing only
$contents = 'Brad Jhon Mike';
fwrite($handle,$contents);
fclose($handle);
```

If we want it with line breacks, we will use `PHP_EOL`:

```php
$handle = fopen($filep,'w');
// w means open for writing only
$contents = 'Brad'.PHP_EOL.'Jhon'.PHP_EOL.'Mike';
fwrite($handle,$contents);
fclose($handle);
```

## File uploading

For uploading a file, first we need a form so let's make it :

```php
<form action="/" method="POST" enctype="multipart/form-data">
    Select image to upload:
    <input type="file" name="upload">
    <br />
    <input type="submit" name="submit" value="Submit" />
</form>
```

Something really important when uploading files is that the `enctype` atribute must be set, if it in's, it will not work.

For the file uploading, we will use one of the [superglobals](#superglobals), the `$_FILES` one.

In this case, we will need the target directory and the file tmp directory. This last one is within the `$_FILES` superglobal.

```php
$file_name = $_FILES['upload']['name']
$target_dir = "uploads/{$file_name}";
$file_tmp = $_FILES['upload']['tmp_name'];

move_uploaded_file($file_tmp,$target_dir);
```

## Exceptions

PHP has an exception model similar to that of other programming languages. An exception can be thrown, and caught ("cached") within PHP. Code may be surrounded in a try block, to facilitate the catching of potential exceptions. Each tru must hav at least one corresponding catch or finally block.

For example, we want to throw an error if we try to divide by 0:

```php
function inverse($x) {
  if(!$x) {
    throw new Exception('Division by zero');
  }
  return 1/$x;
}

echo inverse(10); // 0.1
echo inverse(0);
// Fatal error: Uncaught Exception: Division by zero
```

But let do something with that uncaught exception.

We will do the `echo` inside a `try...catch` block and see what happens :

```php
try {
  echo inverse(10);
  echo inverse(0);
} catch (Exception $e) {
  echo ' Caught Exception ', $e->getMessage();
}
// 0.1 Caught Exception Division by zero
```

We also have `finally` block, that is agnostic about what happens in the `try...catch` :

```php
try {
  echo inverse(10);
  echo inverse(0);
} catch (Exception $e) {
  echo ' Caught Exception ', $e->getMessage();
} finally {
  echo ' Finally!';
}
// 0.1 Caught Exception Division by zero Finally!
```

## OOP

From PHP5 onwards you can write PHP in either procedural or object orientated way. OOP consists of classes that can hold "properties" and "methods", Objects can be created from classes.

Lets create a user using OOP!

```php
class User {
  public $name;
  public $email;
  public $password;
}
```

Those are properties, that are atributes that belong to a class.

Now, we can instantiate a user object :

```php
$user1 = new User();

var_dump($user1);
// object(User)#1 (3) { ["name"]=> NULL ["email"]=> NULL ["password"]=> NULL }
```

Everything is `NULL` as we didn't specify that values, so let's into it :

```php
$user1 = new User();
$user1->name = 'Jhon';
$user1->email = 'jhondoe@gmail.com';
$user1->password = '1234';
print_r($user1);
// User Object ( [name] => Jhon [email] => jhondoe@gmail.com [password] => 1234 )
```

### Access modifiers

There are 3 types of access modifiers :

- Public
  : can be accessed from anywhere.
- Private
  : can only be accessed from inside the class.
- Protected
  : can only be accessed from inside the class and by inheriting classes.

### Method

Method is a function that belongs to a class.

```php
class User {
  public $name;
  public $email;
  public $password;
  function set_name($name){
    $this->name = $name;
  }
}
```

Now, we can acced that function outside the class :

```php
$user2 = new User();

$user2->set_name('Brad');

var_dump($user2);
// object(User)#2 (3) { ["name"]=> string(4) "Brad" ["email"]=> NULL ["password"]=> NULL }
```

### Constructor

A constructor is a method that runs when an object is created.

```php
class User {
  public $name;
  public $email;
  public $password;
  public function __construct($name,$email,$password){
    $this->name = $name;
    $this->email = $email;
    $this->password = $password;
  }
}
```

Now, thanks to the constructor, when we instantiate a user we can pass it the values :

```php
$user1 = new User('Brad','brad@gmail.com','securePassword');
$user2 = new User('Jhon','jhondoe@gmail.com','1234');

print_r($user1);
// User Object ( [name] => Brad [email] => brad@gmail.com [password] => securePassword )
echo '<br/>';
print_r($user2);
// User Object ( [name] => Jhon [email] => jhondoe@gmail.com [password] => 1234 )
```

### Inheritence

When a class belong to other class

```php
class Employee extends User{
  public function __construct($name,$email,$password,$title){
    parent::__construct($name,$email,$password);
    $this->title = $title;
  }
  function get_title(){
    return $this->title;
  }
}
```

Now, we can create an Employee

```php
$employee1 = new Employee('Sara', 'sara@gmail.com', '1password','Manager');
echo $employee1->get_title();// Manager
```
